# FireEye Red Team Exploit Scanner
Powershell script to automate deployment of Yara to scan files for FireEye Exploit using FireEye Exploit Yara Rules

## CREDITS
Credit to VirusTotal for their yara scan tool: https://github.com/VirusTotal/yara

Credit to FireEye for their yara rules file: https://github.com/fireeye/red_team_tool_countermeasures

Credit to Datto and Seagull for inspiration: https://github.com/datto/fireeye-red-team-countermeasure-scanner

## ABOUT
This is a powershell script that can be run locally on any device running Windows OS with Powershell to scan processes or files against the list of FireEye's yara rule to determine if any files match the FireEye's Red Team Exploit yara rule. 

Matches may not necessarily mean the file is an actual exploit.

The script will log the script actions to a log file specified in the variable **$Script:POpsLogFile**.
The script will gather the results from all files scanned with Yara and output to a csv file located in the folder that is specified in the parameter -DestinationFolder.

The only function you need to specify parameters for is **"Invoke-POpsYaraScan"** function, called at the bottom of the script.

## SCRIPT VARIABLES
The script itself doesn't have any parameters, instead, there are functions within the script that are called with pre-defined parameters. 

You will also need to define **$Script variables** between lines 1028 - 1049.

If using with an RMM, set up RMM input and output variables to map to the following script variables:

**Input variables** 
* $InScanLevel
* $InFileType

**Output variables**
* $OutExploitFound
* $OutLogFolder

### $InScanLevel (1 | 2 | 3 | 4)
Default should be 1 if using as a RMM monitor.

If you would like to scan entire drive, then run it as an RMM task instead of a monitor to prevent execution timeouts.

* 1: Scans currently running processes - takes about 10 minutes
* 2: Scans home drive 
* 3: Scans all fixed drives
* 4: Scans all accessible drives

### $InFileType (1 | 2)
Default is 1.
* 1: Scan only exe files - default if $InScanLevel = 1
* 2: Scan exe and dll files


## REQUIREMENTS
Only tested with Powershell on Windows 7 and up and Windows Server 2008 R2 and up.
You will need to grab the latest Yara64.exe and Yara32.exe from the win zip files hosted here:
https://github.com/VirusTotal/yara/releases/

You will need extract the yara32.exe and yara64.exe from each respective zip.
You will only need these yara files (you do not need the "yarac32.exe" nor "yarac64.exe"):
* yara64.exe
* yara32.exe

Then, host/upload the yara64.exe and yara32.exe files somewhere safe and secure that allows https download. Highly recommend a secure cloud object storage for this. Do not upload to consumer cloud drives as they will limit the amount of traffic and downloads.

Keep note of the download urls for both the yara64.exe, and yara32.exe as you will have to provide the urls as parameter values for the **"Invoke-POpsYaraScan"** function, called at the bottom of the script.

You can also host VC++ 2015-2019 bundle exes as well. By default, the script will try to download VC++ first from Microsoft, but you can provide fallback urls if the download from Microsoft fails.
